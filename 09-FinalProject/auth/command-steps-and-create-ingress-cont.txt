cat <<EOF | kind create cluster --config=-
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
EOF







--------------------deploy ingress controller-------------------------------
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml

----------------------------------------------------------------------------

steps:
 1- create new cluster 
 2- create new ingress controller 
 3- create database service (stateful app): 
        1- create headless for stateful
        2- create secrets with imperative way:
            kubectl create secret generic mysql-secret \
            --from-literal=root-password='secure-root-pw' \
            --from-literal=auth-password='my-secret-pw' \
            --from-literal=secret-key='xc0sr0fh4e52x03g9mv'  // secret key used to get jwt token
        3- make job service which will create database and make some commands on db when it startup
        4- create stateful service: 
              kubectl apply -f headless-service.yaml
              kubectl apply -f statefulset.yaml
              kubectl apply -f init-job.yaml
  4- creat Authentication service (statless app):
        1- create deployment.yam file for auth pods 
          - kubectl apply -f auth/deployment.yaml 
        2- create service for these pods from type cluster ip  
          - kubectl apply -f auth/service.yaml
        3- test service with working fine with database
          - kubectl run alpine --rm -it --image=alpine -- sh
          - apk add curl
          - curl -X POST http://weatherapp-auth:8080/users \
            -H "Content-Type: application/json"\
            -d '{"username": "testuser", "password":"testpassword"}'
  5- create weather service

  

